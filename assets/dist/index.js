!function(){"use strict";var e=window.wp.blocks,t=window.wp.element;const{useState:n,useEffect:r,useRef:a}=wp.element,{useState:i,useRef:s,useEffect:l}=wp.element,{SelectControl:o,Button:c,Spinner:p}=wp.components,{InnerBlocks:u,useBlockProps:d,InspectorControls:w}=wp.blockEditor;(0,e.registerBlockType)("wsuwp/html-snippet",{title:"HTML Snippet",icon:"embed-generic",category:"advanced",attributes:{snippet_id:{type:"string",default:""},show_preview:{type:"boolean",default:!0}},edit:e=>{const{className:u,attributes:w,setAttributes:m}=e,[_,h]=i(!1),v=s(null),g="wp-block-wsuwp-html-snippet",f=d({className:g}),{data:b,isLoading:E}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[i,s]=n({data:null,isLoading:!1,error:null}),l=a(null);return r((()=>(s({data:null,isLoading:!0,error:null}),l.current?.abort(),"undefined"!=typeof AbortController&&(l.current=new AbortController),t={...t,signal:l.current?.signal},(async()=>{try{const n=await fetch(e,t),r=await n.json();n.ok?s({data:r,isLoading:!1,error:null}):s({data:null,isLoading:!1,error:`${r.code} | ${r.message} ${n.status} (${n.statusText})`})}catch(e){s({data:null,isLoading:!1,error:e.message})}})(),()=>{l.current?.abort()})),[e]),i}(`${WSUWP_DATA.siteUrl}/wp-json/wp/v2/wsu_html_snippet`);function S(){h(!1),v&&v.current&&(v.current.style.height=null)}if(l((()=>{let e;if(w.show_preview&&(e=setInterval((()=>{const e=v?.current?.contentWindow.document.body?.querySelector("#wsu-gutenberg-snippet-preview")?.offsetHeight;isNaN(e)||(v.current.style.height=e+"px")}),1e3)),e)return()=>clearInterval(e)}),[w.show_preview]),E&&!b)return(0,t.createElement)("p",null,"loading...");if(!E&&!b)return(0,t.createElement)(t.Fragment,null);const $=[{label:"- Select HTML Snippet -",value:""}].concat(b.map((e=>({label:e.title.rendered,value:e.id})))),y=b.find((e=>e.id.toString()===w.snippet_id)),N=function(e){if(!e)return;const t=new URLSearchParams(location.search);return t.set("post",e.id),location.origin+location.pathname+"?"+t.toString()}(y);return(0,t.createElement)("div",f,(0,t.createElement)("div",{className:`${g}__header`},(0,t.createElement)("div",{className:`${g}__label`},(0,t.createElement)("span",{className:"dashicon dashicons dashicons-embed-generic"}),"HTML Snippet"),(0,t.createElement)("div",{className:`${g}__controls`},N&&(0,t.createElement)(c,{className:`${g}__control is-tertiary`,icon:"edit",href:N,target:"_blank"},"Edit Snippet"),(0,t.createElement)(c,{className:`${g}__control is-tertiary`,icon:w.show_preview?"hidden":"visibility",onClick:()=>{S(),m({show_preview:!w.show_preview})}},w.show_preview?"Hide":"Show"," Preview"))),(0,t.createElement)("div",{className:""},(0,t.createElement)(o,{className:`${g}__select-control`,value:w.snippet_id,options:$,onChange:e=>{S(),m({snippet_id:e})}})),y&&w.show_preview&&!_?(0,t.createElement)(p,{className:`${g}__spinner`}):"",y&&w.show_preview?(0,t.createElement)("iframe",{ref:v,className:`${g}__preview ${_?"loaded":""}`,src:`${y.link}&preview=true`,onLoad:e=>{h(!0)}}):"")},save:function(){return null}})}();