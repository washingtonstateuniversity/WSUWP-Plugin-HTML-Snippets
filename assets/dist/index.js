!function(){"use strict";var e=window.wp.blocks,t=window.wp.element;const{useState:n,useEffect:r,useRef:a}=wp.element,{useState:l,useRef:s,useEffect:i}=wp.element,{SelectControl:o,Button:c,Spinner:u}=wp.components;(0,e.registerBlockType)("wsuwp/html-snippet",{title:"HTML Snippet",icon:"embed-generic",category:"advanced",attributes:{snippet_id:{type:"string",default:""},show_preview:{type:"boolean",default:!0}},edit:e=>{const{className:d,attributes:p,setAttributes:w}=e,[m,g]=l(!1),v=s(null),{data:_,isLoading:h}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[l,s]=n({data:null,isLoading:!1,error:null}),i=a(null);return r((()=>(s({data:null,isLoading:!0,error:null}),i.current?.abort(),"undefined"!=typeof AbortController&&(i.current=new AbortController),t={...t,signal:i.current?.signal},(async()=>{try{console.log("Calling: "+e);const n=await fetch(e,t),r=await n.json();n.ok?s({data:r,isLoading:!1,error:null}):s({data:null,isLoading:!1,error:`${r.code} | ${r.message} ${n.status} (${n.statusText})`})}catch(e){s({data:null,isLoading:!1,error:e.message})}})(),()=>{i.current?.abort()})),[e]),l}("/wp-json/wp/v2/wsu_html_snippet");function f(){g(!1),v&&v.current&&(v.current.style.height=null)}if(i((()=>{let e;if(p.show_preview&&(e=setInterval((()=>{const e=v?.current?.contentWindow.document.body?.querySelector("#wsu-gutenberg-snippet-preview")?.offsetHeight;isNaN(e)||(v.current.style.height=e+"px")}),1e3)),e)return()=>clearInterval(e)}),[p.show_preview]),h&&!_)return(0,t.createElement)("p",null,"loading...");if(!h&&!_)return(0,t.createElement)(t.Fragment,null);const b=[{label:"- Select HTML Snippet -",value:""}].concat(_.map((e=>({label:e.title.rendered,value:e.id})))),E=_.find((e=>e.id.toString()===p.snippet_id));return(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{className:d},(0,t.createElement)("div",{className:`${d}__header`},(0,t.createElement)("div",{className:`${d}__label`},(0,t.createElement)("span",{className:"dashicon dashicons dashicons-embed-generic"}),"HTML Snippet"),(0,t.createElement)("div",{className:`${d}__controls`},(0,t.createElement)(c,{className:`${d}__preview-toggle is-tertiary`,icon:p.show_preview?"hidden":"visibility",onClick:()=>{f(),w({show_preview:!p.show_preview})}},p.show_preview?"Hide":"Show"," Preview"))),(0,t.createElement)("div",{className:""},(0,t.createElement)(o,{className:`${d}__select-control`,value:p.snippet_id,options:b,onChange:e=>{f(),w({snippet_id:e})}})),E&&p.show_preview&&!m?(0,t.createElement)(u,{className:`${d}__spinner`}):"",E&&p.show_preview?(0,t.createElement)("iframe",{ref:v,className:`${d}__preview ${m?"loaded":""}`,src:`${E.link}&preview=true`,onLoad:e=>{g(!0)}}):""))},save:function(){return null}})}();