!function(){"use strict";var e=window.wp.blocks,t=window.wp.element;const{useState:n,useEffect:r,useRef:i}=wp.element,{useState:a,useRef:s,useEffect:l}=wp.element,{SelectControl:o,Button:c,Spinner:p}=wp.components,{useBlockProps:u}=wp.blockEditor;(0,e.registerBlockType)("wsuwp/html-snippet",{apiVersion:2,title:"HTML Snippet",icon:"embed-generic",category:"advanced",attributes:{snippet_id:{type:"string",default:""},show_preview:{type:"boolean",default:!0}},edit:e=>{const{attributes:d,setAttributes:w}=e,[m,_]=a(!1),h=s(null),v="wp-block-wsuwp-html-snippet",g=u(),{data:f,isLoading:b}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[a,s]=n({data:null,isLoading:!1,error:null}),l=i(null);return r((()=>(s({data:null,isLoading:!0,error:null}),l.current?.abort(),"undefined"!=typeof AbortController&&(l.current=new AbortController),t={...t,signal:l.current?.signal},(async()=>{try{const n=await fetch(e,t),r=await n.json();n.ok?s({data:r,isLoading:!1,error:null}):s({data:null,isLoading:!1,error:`${r.code} | ${r.message} ${n.status} (${n.statusText})`})}catch(e){s({data:null,isLoading:!1,error:e.message})}})(),()=>{l.current?.abort()})),[e]),a}(`${WSUWP_DATA.siteUrl}/wp-json/wp/v2/wsu_html_snippet`);function E(){_(!1),h&&h.current&&(h.current.style.height=null)}l((()=>{let e;if(d.show_preview&&(e=setInterval((()=>{const e=h?.current?.contentWindow.document.body?.querySelector("#wsu-gutenberg-snippet-preview")?.offsetHeight;isNaN(e)||(h.current.style.height=e+"px")}),1e3)),e)return()=>clearInterval(e)}),[d.show_preview]);const S=f?[{label:"- Select HTML Snippet -",value:""}].concat(f.map((e=>({label:e.title.rendered,value:e.id})))):[],$=f?f.find((e=>e.id.toString()===d.snippet_id)):void 0,y=function(e){if(!e)return;const t=new URLSearchParams(location.search);return t.set("post",e.id),location.origin+location.pathname+"?"+t.toString()}($);return(0,t.createElement)("div",g,b&&!f&&(0,t.createElement)("p",null,"loading..."),!b&&f&&(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{className:`${v}__header`},(0,t.createElement)("div",{className:`${v}__label`},(0,t.createElement)("span",{className:"dashicon dashicons dashicons-embed-generic"}),"HTML Snippet"),(0,t.createElement)("div",{className:`${v}__controls`},y&&(0,t.createElement)(c,{className:`${v}__control is-tertiary`,icon:"edit",href:y,target:"_blank"},"Edit Snippet"),(0,t.createElement)(c,{className:`${v}__control is-tertiary`,icon:d.show_preview?"hidden":"visibility",onClick:()=>{E(),w({show_preview:!d.show_preview})}},d.show_preview?"Hide":"Show"," Preview"))),(0,t.createElement)("div",{className:""},(0,t.createElement)(o,{className:`${v}__select-control`,value:d.snippet_id,options:S,onChange:e=>{E(),w({snippet_id:e})}})),$&&d.show_preview&&!m?(0,t.createElement)(p,{className:`${v}__spinner`}):"",$&&d.show_preview?(0,t.createElement)("iframe",{ref:h,className:`${v}__preview ${m?"loaded":""}`,src:`${$.link}&preview=true`,onLoad:e=>{_(!0)}}):""))},save:function(){return null}})}();